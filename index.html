<html lang="en">
    <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
    <style type="text/css">
        .parent {
            position: relative;
            top: 50%;
            transform: translateY(-50%);
            text-align: center;
        }
        
        body {
            margin: 0;
        }
    </style>
    </head>
    <body onload="init();">
        <div class="parent">
            <canvas id="advertisement" width="300" height="250"></canvas>
        </div>

        <script type="text/javascript" src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
        <script type="text/javascript"
src="https://rawgit.com/olsn/Collision-Detection-for-EaselJS/master/src/ndgmr.Collision.js"></script>
        <script id="adScript">
            var stage;
            var holder;
            var text;
            var image;
            var bitmap;
            var cursor;
            var cur;
            var startGameText;
            var startGameO;
            var isStarted;
            var ponds

            function init () {
                stage = new createjs.Stage('advertisement');

                stage.on('stagemousemove', function (e) {
                    if (!isStarted) {
                        isStarted = true;
                        initCursor();
                        stage.removeChild(startGameO);
                        ga('send', 'event', {
                            eventCategory: 'IAD3 - Pimple Swipe',
                            eventAction: 'IAD3- Swipe Start',
                            eventLabel: 'Shwemom Test Creative 3'
                        });
                        return stage.removeChild(startGameText);
                    }

                    moveCursor(e);
                });

                addHuman();
            }

            function addHuman () {
                image = new Image();
                image.onload = handleComplete;
                image.src = 'assets/images/face.png';

                ponds = new Image();
                ponds.onload = cachePonds;
                ponds.src = 'assets/images/lastpage.jpg';
            }

            function cachePonds () {
                ponds = new createjs.Bitmap(ponds);
                ponds.scaleX = 300/ponds.image.width;
                ponds.scaleY = 250/ponds.image.height;
            }

            function handleComplete () {
                createjs.Touch.enable(stage);
                startGameText = new createjs.Text(
                    'Swipe away her acne now!',
                    '20px Arial',
                    '#000000'
                );

                startGameText.set({
                    x: stage.canvas.width / 2,
                    y: stage.canvas.height/2
                });
                startGameText.textAlign = 'center';

                startGameO = startGameText.clone();
                startGameO.outline = 5;
                startGameO.color = "#fff";

                bitmap = new createjs.Bitmap(image);
                bitmap.scaleX = 300/bitmap.image.width;
                bitmap.scaleY = 250/bitmap.image.height;
                stage.addChild(text);
                stage.addChild(bitmap);

                holder = stage.addChild(new createjs.Container());
                holder.x = holder.y = 0;

                createAcne();
                stage.addChild(startGameO, startGameText);
                stage.update();
            }

            function initCursor () {
                cursor = new Image();
                cursor.onload = addCursor;
                cursor.src = 'assets/images/ponds.png';

            }

            function createAcne (count) {
                var total = count || 10;

                for (var i = 0; i < total; i++) {
                    var circle = new createjs.Shape();
                    circle.graphics.beginRadialGradientFill(
                        ["#DE7B68", "#DCBEB3"],
                        [0, 1], 0, 0, 1, 0, 0, 4
                    )
                    .drawCircle(0, 0, 2);
                    circle.x = randomBet(105, 212);
                    circle.y = randomBet(53, 188);
                    holder.addChild(circle);
                }

            }

            function addCursor () {
                cur = new createjs.Bitmap(cursor);
                cur.scaleX = 50/cur.image.width;
                cur.scaleY = 50/cur.image.height;
                cur.cursor = 'pointer';

                cur.on("pressmove", moveCursor);

                stage.addChild(cur);

                stage.enableMouseOver();
                stage.update();
                createjs.Ticker.on('tick', function (e) {
                    stage.update(e);
                });
            }

            function moveCursor (evt) {
                var bounds = cur.getBounds();

                cur.x = evt.stageX - (bounds.width * cur.scaleX)/2;
                cur.y = evt.stageY - (bounds.height * cur.scaleY)/2;
                tick();
            }

            function tick (evt) {
                var l = holder.getNumChildren();
                for (var i = 0; i < l; i++) {
                    var child = holder.getChildAt(i);

                    if (!child) {
                        return;
                    }

                    var pt = child.globalToLocal(stage.mouseX, stage.mouseY);

                    if (ndgmr.checkRectCollision(cur, child)) {
                        holder.removeChild(child);

                        if (l === 1) {
                            gameOver();
                        }
                    }

                }

                evt && stage.update(evt);
            }

            function gameOver () {
                stage.removeAllChildren();
                
                ga('send', 'event', {
                    eventCategory: 'IAD3 - Pimple Swipe',
                    eventAction: 'IAD3- Swipe Success',
                    eventLabel: 'Shwemom Test Creative 3'
                });

                text = new createjs.Text(
                    'Pondâ€™s Acne Clear White Facial Wash\n' +
                    'is the ultimate must-have because it fights\n'+
                    '10 oil and acne problems,\nclick here to find out more',
                    '15px Arial',
                    '#000000'
                );
                text.textAlign = 'center';

                var bounds = text.getBounds();
                var hit = new createjs.Shape();
                hit.graphics
                    .beginFill("#000")
                    .drawRect(bounds.x, bounds.y, bounds.width, bounds.height);

                text.hitArea = hit;
                text.set({x: stage.canvas.width / 2, y: stage.canvas.height - 80});

                text.on('click', function (evt) {
                    ga('send', 'event', {
                        eventCategory: 'IAD3 - Pimple Swipe',
                        eventAction: 'IAD3- Outbound Click',
                        eventLabel: 'Shwemom Test Creative 3'
                    });
                    window.open('http://www.shwemom.com/');
                });

                text.cursor = 'pointer';

                stage.addChild(ponds);
                stage.addChild(text);
                stage.update();
            }

            function randomBet(min, max) {
                return Math.floor(Math.random() * (max - min + 1) + min);
            }
        </script>
    </body>
</html>
